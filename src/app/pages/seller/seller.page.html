<app-header 
  [title]="'My Products'" 
  [showBackButton]="true" 
  [unreadNotifications]="unreadNotifications" 
  (backClicked)="onBackClick()">
</app-header>

<ion-content>
  
  <!-- Welcome Section -->
  <ion-card class="welcome-card">
    <ion-card-header>
      <ion-card-title>Gestión de Productos</ion-card-title>
      <ion-card-subtitle>Administra tus perfumes y marcas</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p>Desde aquí puedes agregar nuevos perfumes, editar existentes y gestionar tus marcas y categorías.</p>
    </ion-card-content>
  </ion-card>

  <!-- Add Products Button -->
   <div class="ion-padding">
    <ion-button 
      expand="block" 
      (click)="openAddProductStepper()"
      class="add-product-btn">
      <ion-icon slot="start" name="add-circle"></ion-icon>
      Agregar Nuevo Perfume
    </ion-button>
  </div>

  <!-- Products Grid -->
  <div class="products-section ion-padding">
    <div class="section-header">
      <h2>Mis Perfumes</h2>
      <span class="products-count">{{ perfumes.length || 0 }} productos</span>
    </div>

    <!-- Toolbar with Delete Selected Button -->
    <div *ngIf="perfumes && perfumes.length > 0 && selectedPerfumes.size > 0" class="delete-toolbar">
      <ion-button 
        fill="solid"
        color="danger"
        (click)="deleteSelectedPerfumes()">
        <ion-icon slot="start" name="trash"></ion-icon>
        Eliminar Seleccionados ({{ selectedPerfumes.size || 0 }})
      </ion-button>
    </div>

    <!-- Products Grid View -->
    <div *ngIf="perfumes && perfumes.length > 0" class="products-grid">
      <ion-card *ngFor="let perfume of perfumes" class="product-card">
        
        <!-- Checkbox overlay -->
        <div class="card-checkbox">
          <ion-checkbox 
            [checked]="isSelected(perfume.id!)"
            (ionChange)="toggleSelectPerfume(perfume.id!)">
          </ion-checkbox>
        </div>

        <!-- Product Image -->
        <div class="product-image-container">
          <img 
            *ngIf="perfume.imageUrl" 
            [src]="perfume.imageUrl" 
            [alt]="perfume.name" 
            class="product-image"
            (error)="onImageError(perfume)">
          <div *ngIf="!perfume.imageUrl" class="product-image-placeholder">
            <ion-icon name="image"></ion-icon>
          </div>
          
          <!-- Stock Badge -->
          <div class="stock-badge" [class.low-stock]="perfume.stock! < 10">
            <ion-icon name="cube-outline" slot="start"></ion-icon>
            {{ perfume.stock }} u.
          </div>
        </div>

        <!-- Card Header with Title -->
        <ion-card-header>
          <ion-card-title class="product-name">{{ perfume.name }}</ion-card-title>
          <ion-card-subtitle>{{ perfume.brand?.name || 'Sin marca' }}</ion-card-subtitle>
        </ion-card-header>

        <!-- Card Content -->
        <ion-card-content>
          <!-- Description -->
          <p class="product-description">{{ perfume.description }}</p>

          <!-- Meta Information -->
          <div class="product-meta">
            <div class="meta-item">
              <span class="label">
                <ion-icon name="wine"></ion-icon>
                Género
              </span>
              <span class="value">{{ perfume.genre }}</span>
            </div>
            <div class="meta-item">
              <span class="label">
                <ion-icon name="flask"></ion-icon>
                Tamaño
              </span>
              <span class="value">{{ perfume.sizeMl }}ml</span>
            </div>
            <div class="meta-item">
              <span class="label">
                <ion-icon name="pricetag"></ion-icon>
                Precio
              </span>
              <span class="value price">${{ perfume.price | number:'1.2-2' }}</span>
            </div>
          </div>

          <!-- Category Badge -->
          <div class="category-badge">
            <ion-badge>{{ perfume.category?.name || 'Sin categoría' }}</ion-badge>
          </div>
        </ion-card-content>

        <!-- Card Footer with Actions -->
        <div class="card-actions">
          <ion-button 
            fill="clear" 
            color="primary" 
            size="small" 
            (click)="startEditPerfume(perfume)">
            <ion-icon name="pencil" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button 
            fill="clear" 
            color="danger" 
            size="small" 
            (click)="deletePerfume(perfume.id!)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button 
            fill="clear" 
            color="secondary" 
            size="small" 
            (click)="viewPerfumeDetails(perfume)">
            <ion-icon name="eye" slot="icon-only"></ion-icon>
          </ion-button>
        </div>

      </ion-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="!perfumes || perfumes.length === 0" class="empty-state">
      <ion-icon name="cube-outline"></ion-icon>
      <h3>No hay perfumes aún</h3>
      <p>¡Crea tu primer perfume usando el botón de arriba!</p>
    </div>

    <!-- Loading State -->
    <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
  </div>

</ion-content>

<!-- Stepper Component Overlay -->
<app-stepper></app-stepper>

<app-footer></app-footer>