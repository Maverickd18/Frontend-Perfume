<app-header [title]="'My Store'" [showBackButton]="true" [unreadNotifications]="store.nombre ? unreadNotifications : 0" (backClicked)="onBackClick()"></app-header>

<ion-content class="ion-padding">
  
  <!-- Form to Create My Store (show only if store doesn't exist) -->
  <ion-card *ngIf="showCreateStore && !store.nombre">
    <ion-card-header>
      <ion-card-title>Create My Store</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <app-input 
        [label]="'Store Name'" 
        [placeholder]="'e.g., My Perfume Shop'"
        [type]="'text'"
        [(ngModel)]="newStore.nombre">
      </app-input>
      <app-input 
        [label]="'Description'" 
        [placeholder]="'Describe your store...'"
        [type]="'text'"
        [(ngModel)]="newStore.descripcion">
      </app-input>
      <app-input 
        [label]="'Owner Name'" 
        [placeholder]="'Your name'"
        [type]="'text'"
        [(ngModel)]="newStore.propietario">
      </app-input>
      <div class="ion-margin-top">
        <ion-button expand="block" color="success" (click)="createStore()">Create Store</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Store Info Card (show only after store is created) -->
  <ion-card *ngIf="store.nombre">
    <ion-card-header>
      <ion-card-title>{{ store.nombre }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ store.descripcion }}</p>
      <p><strong>Owner:</strong> {{ store.propietario }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Add Products Button (show only after store is created) -->
  <ion-button *ngIf="store.nombre" expand="block" color="primary" (click)="toggleAddForm()">
    <ion-icon slot="start" name="add-circle"></ion-icon>
    Add Products
  </ion-button>

  <!-- Form to Add Product (show only if toggled and store exists) -->
  <ion-card *ngIf="showAddForm && store.nombre">
    <ion-card-header>
      <ion-card-title>New Product</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <app-input 
        [label]="'Product Name'" 
        [placeholder]="'e.g., Rose Perfume Premium'"
        [type]="'text'"
        [(ngModel)]="newPerfume.nombre">
      </app-input>
      <app-input 
        [label]="'Description'" 
        [placeholder]="'Describe the scent...'"
        [type]="'text'"
        [(ngModel)]="newPerfume.descripcion">
      </app-input>
      <app-input 
        [label]="'Price ($)'" 
        [placeholder]="'150'"
        [type]="'number'"
        [(ngModel)]="newPerfume.precio">
      </app-input>
      <app-input 
        [label]="'Stock (Units)'" 
        [placeholder]="'10'"
        [type]="'number'"
        [(ngModel)]="newPerfume.stock">
      </app-input>
      <app-input 
        [label]="'Size (ml)'" 
        [placeholder]="'100'"
        [type]="'number'"
        [(ngModel)]="newPerfume.tamano_ml">
      </app-input>
      <ion-item>
        <ion-label position="floating">Gender</ion-label>
        <ion-select [(ngModel)]="newPerfume.genero" placeholder="Select a gender">
          <ion-select-option value="Masculine">Masculine</ion-select-option>
          <ion-select-option value="Feminine">Feminine</ion-select-option>
          <ion-select-option value="Unisex">Unisex</ion-select-option>
        </ion-select>
      </ion-item>
      <div class="ion-margin-top">
        <ion-button expand="block" color="success" (click)="addPerfume()">Save Product</ion-button>
        <ion-button expand="block" color="medium" (click)="toggleAddForm()">Cancel</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Products List (show only after store is created) -->
  <div *ngIf="store.nombre">
    <ion-card>
      <ion-card-header>
        <ion-card-title>My Products ({{ perfumes.length || 0 }})</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Toolbar with Delete Selected Button -->
        <div *ngIf="perfumes && perfumes.length > 0" class="ion-margin-bottom">
          <ion-button 
            expand="block" 
            color="danger" 
            [disabled]="selectedPerfumes.size === 0"
            (click)="deleteSelectedPerfumes()">
            <ion-icon slot="start" name="trash"></ion-icon>
            Delete Selected ({{ selectedPerfumes.size }})
          </ion-button>
        </div>

        <ion-list *ngIf="perfumes && perfumes.length > 0">
          <div *ngFor="let perfume of perfumes">
            <!-- Product Card View -->
            <ion-item-sliding *ngIf="editingPerfume?.id !== perfume.id">
              <ion-item>
                <ion-checkbox 
                  slot="start" 
                  [checked]="isSelected(perfume.id!)"
                  (ionChange)="toggleSelectPerfume(perfume.id!)">
                </ion-checkbox>
                <ion-label>
                  <h2>{{ perfume.nombre }}</h2>
                  <p>{{ perfume.descripcion }}</p>
                  <p><strong>Price:</strong> ${{ perfume.precio }} | <strong>Stock:</strong> {{ perfume.stock }} | <strong>Size:</strong> {{ perfume.tamano_ml }}ml | <strong>Gender:</strong> {{ perfume.genero }}</p>
                </ion-label>
              </ion-item>
              <ion-item-options side="end">
                <ion-item-option color="primary" (click)="startEditPerfume(perfume)">
                  <ion-icon slot="icon-only" name="pencil"></ion-icon>
                </ion-item-option>
                <ion-item-option color="danger" (click)="deletePerfume(perfume.id!)">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>

            <!-- Edit Form inside Product Card -->
            <ion-card *ngIf="editingPerfume?.id === perfume.id" class="ion-margin-top ion-margin-bottom">
              <ion-card-header>
                <ion-card-title>Edit: {{ perfume.nombre }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <app-input 
                  [label]="'Product Name'" 
                  [placeholder]="'e.g., Rose Perfume Premium'"
                  [type]="'text'"
                  [(ngModel)]="editingPerfume!.nombre">
                </app-input>
                <app-input 
                  [label]="'Description'" 
                  [placeholder]="'Describe the scent...'"
                  [type]="'text'"
                  [(ngModel)]="editingPerfume!.descripcion">
                </app-input>
                <app-input 
                  [label]="'Price ($)'" 
                  [placeholder]="'150'"
                  [type]="'number'"
                  [(ngModel)]="editingPerfume!.precio">
                </app-input>
                <app-input 
                  [label]="'Stock (Units)'" 
                  [placeholder]="'10'"
                  [type]="'number'"
                  [(ngModel)]="editingPerfume!.stock">
                </app-input>
                <app-input 
                  [label]="'Size (ml)'" 
                  [placeholder]="'100'"
                  [type]="'number'"
                  [(ngModel)]="editingPerfume!.tamano_ml">
                </app-input>
                <ion-item>
                  <ion-label position="floating">Gender</ion-label>
                  <ion-select [(ngModel)]="editingPerfume!.genero" placeholder="Select a gender">
                    <ion-select-option value="Masculine">Masculine</ion-select-option>
                    <ion-select-option value="Feminine">Feminine</ion-select-option>
                    <ion-select-option value="Unisex">Unisex</ion-select-option>
                  </ion-select>
                </ion-item>
                <div class="ion-margin-top">
                  <ion-button expand="block" color="success" (click)="saveEditPerfume()">Save Changes</ion-button>
                  <ion-button expand="block" color="medium" (click)="cancelEditPerfume()">Cancel</ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </div>
        </ion-list>

        <!-- Message if no products -->
        <ion-text *ngIf="!perfumes || perfumes.length === 0" color="medium">
          <p class="ion-text-center ion-margin-top">No products yet. Create your first product!</p>
        </ion-text>
      </ion-card-content>
    </ion-card>
  </div>

</ion-content>

<app-footer></app-footer>