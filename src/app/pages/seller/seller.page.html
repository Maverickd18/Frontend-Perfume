<ion-header>
  <ion-toolbar>
    <ion-title>My Store</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <!-- Form to Create My Store (show only if store doesn't exist) -->
  <ion-card *ngIf="showCreateStore && !store.nombre">
    <ion-card-header>
      <ion-card-title>Create My Store</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Store Name</ion-label>
        <ion-input [(ngModel)]="newStore.nombre" type="text" placeholder="e.g., My Perfume Shop"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Description</ion-label>
        <ion-textarea [(ngModel)]="newStore.descripcion" placeholder="Describe your store..."></ion-textarea>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Owner Name</ion-label>
        <ion-input [(ngModel)]="newStore.propietario" type="text" placeholder="Your name"></ion-input>
      </ion-item>
      <div class="ion-margin-top">
        <ion-button expand="block" color="success" (click)="createStore()">Create Store</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Store Info Card (show only after store is created) -->
  <ion-card *ngIf="store.nombre">
    <ion-card-header>
      <ion-card-title>{{ store.nombre }}</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>{{ store.descripcion }}</p>
      <p><strong>Owner:</strong> {{ store.propietario }}</p>
    </ion-card-content>
  </ion-card>

  <!-- Add Products Button (show only after store is created) -->
  <ion-button *ngIf="store.nombre" expand="block" color="primary" (click)="toggleAddForm()">
    <ion-icon slot="start" name="add-circle"></ion-icon>
    Add Products
  </ion-button>

  <!-- Form to Add Product (show only if toggled and store exists) -->
  <ion-card *ngIf="showAddForm && store.nombre">
    <ion-card-header>
      <ion-card-title>New Product</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="floating">Product Name</ion-label>
        <ion-input [(ngModel)]="newPerfume.nombre" type="text" placeholder="e.g., Rose Perfume Premium"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Description</ion-label>
        <ion-textarea [(ngModel)]="newPerfume.descripcion" placeholder="Describe the scent and characteristics..."></ion-textarea>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Price ($)</ion-label>
        <ion-input [(ngModel)]="newPerfume.precio" type="number" placeholder="150"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Stock (Units)</ion-label>
        <ion-input [(ngModel)]="newPerfume.stock" type="number" placeholder="10"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Size (ml)</ion-label>
        <ion-input [(ngModel)]="newPerfume.tamano_ml" type="number" placeholder="100"></ion-input>
      </ion-item>
      <ion-item>
        <ion-label position="floating">Gender</ion-label>
        <ion-select [(ngModel)]="newPerfume.genero" placeholder="Select a gender">
          <ion-select-option value="Masculine">Masculine</ion-select-option>
          <ion-select-option value="Feminine">Feminine</ion-select-option>
          <ion-select-option value="Unisex">Unisex</ion-select-option>
        </ion-select>
      </ion-item>
      <div class="ion-margin-top">
        <ion-button expand="block" color="success" (click)="addPerfume()">Save Product</ion-button>
        <ion-button expand="block" color="medium" (click)="toggleAddForm()">Cancel</ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Products List (show only after store is created) -->
  <div *ngIf="store.nombre">
    <ion-card>
      <ion-card-header>
        <ion-card-title>My Products ({{ perfumes.length || 0 }})</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <!-- Toolbar with Delete Selected Button -->
        <div *ngIf="perfumes && perfumes.length > 0" class="ion-margin-bottom">
          <ion-button 
            expand="block" 
            color="danger" 
            [disabled]="selectedPerfumes.size === 0"
            (click)="deleteSelectedPerfumes()">
            <ion-icon slot="start" name="trash"></ion-icon>
            Delete Selected ({{ selectedPerfumes.size }})
          </ion-button>
        </div>

        <ion-list *ngIf="perfumes && perfumes.length > 0">
          <div *ngFor="let perfume of perfumes">
            <!-- Product Card View -->
            <ion-item-sliding *ngIf="editingPerfume?.id !== perfume.id">
              <ion-item>
                <ion-checkbox 
                  slot="start" 
                  [checked]="isSelected(perfume.id!)"
                  (ionChange)="toggleSelectPerfume(perfume.id!)">
                </ion-checkbox>
                <ion-label>
                  <h2>{{ perfume.nombre }}</h2>
                  <p>{{ perfume.descripcion }}</p>
                  <p><strong>Price:</strong> ${{ perfume.precio }} | <strong>Stock:</strong> {{ perfume.stock }} | <strong>Size:</strong> {{ perfume.tamano_ml }}ml | <strong>Gender:</strong> {{ perfume.genero }}</p>
                </ion-label>
              </ion-item>
              <ion-item-options side="end">
                <ion-item-option color="primary" (click)="startEditPerfume(perfume)">
                  <ion-icon slot="icon-only" name="pencil"></ion-icon>
                </ion-item-option>
                <ion-item-option color="danger" (click)="deletePerfume(perfume.id!)">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>
                </ion-item-option>
              </ion-item-options>
            </ion-item-sliding>

            <!-- Edit Form inside Product Card -->
            <ion-card *ngIf="editingPerfume?.id === perfume.id" class="ion-margin-top ion-margin-bottom">
              <ion-card-header>
                <ion-card-title>Edit: {{ perfume.nombre }}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                <ion-item>
                  <ion-label position="floating">Product Name</ion-label>
                  <ion-input [(ngModel)]="editingPerfume!.nombre" type="text" placeholder="e.g., Rose Perfume Premium"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Description</ion-label>
                  <ion-textarea [(ngModel)]="editingPerfume!.descripcion" placeholder="Describe the scent and characteristics..."></ion-textarea>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Price ($)</ion-label>
                  <ion-input [(ngModel)]="editingPerfume!.precio" type="number" placeholder="150"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Stock (Units)</ion-label>
                  <ion-input [(ngModel)]="editingPerfume!.stock" type="number" placeholder="10"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Size (ml)</ion-label>
                  <ion-input [(ngModel)]="editingPerfume!.tamano_ml" type="number" placeholder="100"></ion-input>
                </ion-item>
                <ion-item>
                  <ion-label position="floating">Gender</ion-label>
                  <ion-select [(ngModel)]="editingPerfume!.genero" placeholder="Select a gender">
                    <ion-select-option value="Masculine">Masculine</ion-select-option>
                    <ion-select-option value="Feminine">Feminine</ion-select-option>
                    <ion-select-option value="Unisex">Unisex</ion-select-option>
                  </ion-select>
                </ion-item>
                <div class="ion-margin-top">
                  <ion-button expand="block" color="success" (click)="saveEditPerfume()">Save Changes</ion-button>
                  <ion-button expand="block" color="medium" (click)="cancelEditPerfume()">Cancel</ion-button>
                </div>
              </ion-card-content>
            </ion-card>
          </div>
        </ion-list>

        <!-- Message if no products -->
        <ion-text *ngIf="!perfumes || perfumes.length === 0" color="medium">
          <p class="ion-text-center ion-margin-top">No products yet. Create your first product!</p>
        </ion-text>
      </ion-card-content>
    </ion-card>
  </div>

</ion-content>
