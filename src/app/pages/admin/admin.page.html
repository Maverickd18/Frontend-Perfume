<ion-content>
  <div class="admin-content">

    <!-- NAVEGACIÓN POR TABS -->
    <ion-segment [(ngModel)]="selectedTab" (ionChange)="selectTab(selectedTab)" class="admin-tabs">
      <ion-segment-button value="dashboard">
        <ion-icon name="analytics"></ion-icon>
        <ion-label>Dashboard</ion-label>
      </ion-segment-button>
      <ion-segment-button value="users">
        <ion-icon name="people"></ion-icon>
        <ion-label>Usuarios</ion-label>
      </ion-segment-button>
      <ion-segment-button value="stores">
        <ion-icon name="storefront"></ion-icon>
        <ion-label>Tiendas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="brands">
        <ion-icon name="bookmark"></ion-icon>
        <ion-label>Marcas</ion-label>
      </ion-segment-button>
      <ion-segment-button value="categories">
        <ion-icon name="list"></ion-icon>
        <ion-label>Categorías</ion-label>
      </ion-segment-button>
      <ion-segment-button value="perfumes">
        <ion-icon name="flower"></ion-icon>
        <ion-label>Perfumes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="orders">
        <ion-icon name="cube"></ion-icon>
        <ion-label>Pedidos</ion-label>
      </ion-segment-button>
    </ion-segment>

    <!-- ============= DASHBOARD ============= -->
    <div *ngIf="selectedTab === 'dashboard'" class="tab-content">
      <h1>Dashboard</h1>
      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="kpi-grid" *ngIf="dashboardStats && !isLoading">
        <div class="kpi-card">
          <ion-icon name="people" class="kpi-icon users-icon"></ion-icon>
          <p class="kpi-label">Usuarios Totales</p>
          <p class="kpi-value">{{ dashboardStats.totalUsers }}</p>
          <p class="kpi-subtitle">{{ dashboardStats.activeUsers }} activos</p>
        </div>

        <div class="kpi-card">
          <ion-icon name="storefront" class="kpi-icon stores-icon"></ion-icon>
          <p class="kpi-label">Tiendas</p>
          <p class="kpi-value">{{ dashboardStats.totalStores }}</p>
          <p class="kpi-subtitle">{{ dashboardStats.pendingStores }} pendientes</p>
        </div>

        <div class="kpi-card">
          <ion-icon name="cube" class="kpi-icon orders-icon"></ion-icon>
          <p class="kpi-label">Pedidos</p>
          <p class="kpi-value">{{ dashboardStats.totalOrders }}</p>
          <p class="kpi-subtitle">{{ dashboardStats.pendingOrders }} pendientes</p>
        </div>

        <div class="kpi-card">
          <ion-icon name="cash" class="kpi-icon revenue-icon"></ion-icon>
          <p class="kpi-label">Ingresos Mes</p>
          <p class="kpi-value">${{ dashboardStats.monthlyRevenue | number: '1.0-0' }}</p>
          <p class="kpi-subtitle">Total: ${{ dashboardStats.totalRevenue | number: '1.0-0' }}</p>
        </div>
      </div>
    </div>

    <!-- ============= USUARIOS ============= -->
    <div *ngIf="selectedTab === 'users'" class="tab-content">
      <h1>Gestión de Usuarios</h1>
      
      <ion-card class="filters-card">
        <ion-card-content>
          <ion-searchbar 
            placeholder="Buscar por nombre o email..." 
            [(ngModel)]="userSearchTerm"
            (ionChange)="searchUsers(userSearchTerm)">
          </ion-searchbar>
          <ion-segment [(ngModel)]="userFilterStatus" (ionChange)="filterUsersByStatus(userFilterStatus)" class="filter-segment">
            <ion-segment-button value="all">Todos</ion-segment-button>
            <ion-segment-button value="activo">Activos</ion-segment-button>
            <ion-segment-button value="bloqueado">Bloqueados</ion-segment-button>
          </ion-segment>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="table-container" *ngIf="!isLoading && filteredUsers.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Tipo</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of paginatedUsers">
              <td>{{ user.id }}</td>
              <td>{{ user.nombre }}</td>
              <td>{{ user.email }}</td>
              <td>
                <ion-badge [color]="user.tipoUsuario === 'vendedor' ? 'primary' : 'medium'">
                  {{ user.tipoUsuario }}
                </ion-badge>
              </td>
              <td>
                <ion-badge [color]="user.estado === 'activo' ? 'success' : 'danger'">
                  {{ user.estado }}
                </ion-badge>
              </td>
              <td>
                <ion-button size="small" color="primary" (click)="viewUserDetails(user)">
                  <ion-icon name="eye"></ion-icon>
                </ion-button>
                <ion-button 
                  size="small" 
                  [color]="user.estado === 'bloqueado' ? 'success' : 'danger'"
                  (click)="user.estado === 'bloqueado' ? unbanUser(user.id) : banUser(user.id)">
                  <ion-icon [name]="user.estado === 'bloqueado' ? 'checkmark' : 'close'"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalUserPages > 1">
        <ion-button (click)="userPage = userPage - 1" [disabled]="userPage === 1">
          <ion-icon slot="start" name="chevron-back"></ion-icon>
          Anterior
        </ion-button>
        <span>{{ userPage }} / {{ totalUserPages }}</span>
        <ion-button (click)="userPage = userPage + 1" [disabled]="userPage === totalUserPages">
          Siguiente
          <ion-icon slot="end" name="chevron-forward"></ion-icon>
        </ion-button>
      </div>

      <div *ngIf="!isLoading && filteredUsers.length === 0" class="no-results">
        <p>No se encontraron usuarios</p>
      </div>

      <!-- Modal detalles usuario -->
      <div class="detail-modal" *ngIf="selectedUser" (click)="closeUserDetails()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <ion-button fill="clear" class="close-btn" (click)="closeUserDetails()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
          <h2>Detalles del Usuario</h2>
          <div class="detail-info">
            <p><strong>ID:</strong> {{ selectedUser.id }}</p>
            <p><strong>Nombre:</strong> {{ selectedUser.nombre }}</p>
            <p><strong>Email:</strong> {{ selectedUser.email }}</p>
            <p><strong>Teléfono:</strong> {{ selectedUser.telefono }}</p>
            <p><strong>Tipo:</strong> {{ selectedUser.tipoUsuario }}</p>
            <p><strong>Estado:</strong> {{ selectedUser.estado }}</p>
            <p><strong>Fecha Registro:</strong> {{ selectedUser.fechaRegistro }}</p>
            <p *ngIf="selectedUser.tienda"><strong>Tienda:</strong> {{ selectedUser.tienda }}</p>
            <p><strong>Órdenes:</strong> {{ selectedUser.ordenes }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ============= TIENDAS ============= -->
    <div *ngIf="selectedTab === 'stores'" class="tab-content">
      <h1>Gestión de Tiendas</h1>
      
      <ion-card class="filters-card">
        <ion-card-content>
          <ion-searchbar 
            placeholder="Buscar tiendas..." 
            [(ngModel)]="storeSearchTerm"
            (ionChange)="searchStores(storeSearchTerm)">
          </ion-searchbar>
          <ion-segment [(ngModel)]="storeFilterStatus" (ionChange)="filterStoresByStatus(storeFilterStatus)" class="filter-segment">
            <ion-segment-button value="all">Todas</ion-segment-button>
            <ion-segment-button value="verificada">Verificadas</ion-segment-button>
            <ion-segment-button value="pendiente">Pendientes</ion-segment-button>
            <ion-segment-button value="suspendida">Suspendidas</ion-segment-button>
          </ion-segment>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="table-container" *ngIf="!isLoading && filteredStores.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Propietario</th>
              <th>Productos</th>
              <th>Ventas Mes</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let store of paginatedStores">
              <td>{{ store.nombre }}</td>
              <td>{{ store.propietario }}</td>
              <td>{{ store.productosActivos }}</td>
              <td>${{ store.ventasMes | number: '1.0-0' }}</td>
              <td>
                <ion-badge [color]="store.estado === 'verificada' ? 'success' : store.estado === 'suspendida' ? 'danger' : 'warning'">
                  {{ store.estado }}
                </ion-badge>
              </td>
              <td>
                <ion-button size="small" color="primary" (click)="viewStoreDetails(store)">
                  <ion-icon name="eye"></ion-icon>
                </ion-button>
                <ion-button *ngIf="store.estado === 'pendiente'" size="small" color="success" (click)="verifyStore(store.id)">
                  <ion-icon name="checkmark"></ion-icon>
                </ion-button>
                <ion-button *ngIf="store.estado !== 'suspendida'" size="small" color="danger" (click)="suspendStore(store.id)">
                  <ion-icon name="ban"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalStorePages > 1">
        <ion-button (click)="storePage = storePage - 1" [disabled]="storePage === 1">
          <ion-icon slot="start" name="chevron-back"></ion-icon>
        </ion-button>
        <span>{{ storePage }} / {{ totalStorePages }}</span>
        <ion-button (click)="storePage = storePage + 1" [disabled]="storePage === totalStorePages">
          <ion-icon slot="end" name="chevron-forward"></ion-icon>
        </ion-button>
      </div>

      <div *ngIf="!isLoading && filteredStores.length === 0" class="no-results">
        <p>No se encontraron tiendas</p>
      </div>

      <!-- Modal detalles tienda -->
      <div class="detail-modal" *ngIf="selectedStore" (click)="closeStoreDetails()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <ion-button fill="clear" class="close-btn" (click)="closeStoreDetails()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
          <h2>Detalles de la Tienda</h2>
          <div class="detail-info">
            <p><strong>Nombre:</strong> {{ selectedStore.nombre }}</p>
            <p><strong>Propietario:</strong> {{ selectedStore.propietario }}</p>
            <p><strong>Email:</strong> {{ selectedStore.email }}</p>
            <p><strong>Descripción:</strong> {{ selectedStore.descripcion }}</p>
            <p><strong>Productos Activos:</strong> {{ selectedStore.productosActivos }}</p>
            <p><strong>Ventas Este Mes:</strong> ${{ selectedStore.ventasMes | number: '1.0-0' }}</p>
            <p><strong>Calificación:</strong> {{ selectedStore.calificacion }}/5 ⭐</p>
            <p><strong>Estado:</strong> {{ selectedStore.estado }}</p>
            <p><strong>Fecha Creación:</strong> {{ selectedStore.fechaCreacion }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ============= MARCAS ============= -->
    <div *ngIf="selectedTab === 'brands'" class="tab-content">
      <h1>Gestión de Marcas</h1>
      
      <ion-card class="add-form-card">
        <ion-card-header>
          <ion-card-title>Crear Nueva Marca</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-input placeholder="Nombre de marca" [(ngModel)]="newBrandName"></ion-input>
          <ion-textarea placeholder="Descripción" [(ngModel)]="newBrandDescription"></ion-textarea>
          <ion-button expand="block" color="success" (click)="createBrand()">
            <ion-icon name="add"></ion-icon> Crear Marca
          </ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="filters-card">
        <ion-card-content>
          <ion-searchbar 
            placeholder="Buscar marcas..." 
            [(ngModel)]="brandSearchTerm"
            (ionChange)="searchBrands(brandSearchTerm)">
          </ion-searchbar>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="grid-container" *ngIf="!isLoading && filteredBrands.length > 0">
        <div class="grid-item" *ngFor="let brand of paginatedBrands">
          <ion-card>
            <ion-card-header>
              <ion-card-title>{{ brand.nombre }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p>{{ brand.descripcion || 'Sin descripción' }}</p>
              <div class="actions">
                <ion-button size="small" color="danger" (click)="deleteBrand(brand.id)">
                  <ion-icon name="trash"></ion-icon> Eliminar
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <div class="pagination" *ngIf="totalBrandPages > 1">
        <ion-button (click)="brandPage = brandPage - 1" [disabled]="brandPage === 1">Anterior</ion-button>
        <span>{{ brandPage }} / {{ totalBrandPages }}</span>
        <ion-button (click)="brandPage = brandPage + 1" [disabled]="brandPage === totalBrandPages">Siguiente</ion-button>
      </div>

      <div *ngIf="!isLoading && filteredBrands.length === 0" class="no-results">
        <p>No se encontraron marcas</p>
      </div>
    </div>

    <!-- ============= CATEGORÍAS ============= -->
    <div *ngIf="selectedTab === 'categories'" class="tab-content">
      <h1>Gestión de Categorías</h1>
      
      <ion-card class="add-form-card">
        <ion-card-header>
          <ion-card-title>Crear Nueva Categoría</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-input placeholder="Nombre de categoría" [(ngModel)]="newCategoryName"></ion-input>
          <ion-textarea placeholder="Descripción" [(ngModel)]="newCategoryDescription"></ion-textarea>
          <ion-button expand="block" color="success" (click)="createCategory()">
            <ion-icon name="add"></ion-icon> Crear Categoría
          </ion-button>
        </ion-card-content>
      </ion-card>

      <ion-card class="filters-card">
        <ion-card-content>
          <ion-searchbar 
            placeholder="Buscar categorías..." 
            [(ngModel)]="categorySearchTerm"
            (ionChange)="searchCategories(categorySearchTerm)">
          </ion-searchbar>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="grid-container" *ngIf="!isLoading && filteredCategories.length > 0">
        <div class="grid-item" *ngFor="let category of paginatedCategories">
          <ion-card>
            <ion-card-header>
              <ion-card-title>{{ category.nombre }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p>{{ category.descripcion || 'Sin descripción' }}</p>
              <div class="actions">
                <ion-button size="small" color="danger" (click)="deleteCategory(category.id)">
                  <ion-icon name="trash"></ion-icon> Eliminar
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <div class="pagination" *ngIf="totalCategoryPages > 1">
        <ion-button (click)="categoryPage = categoryPage - 1" [disabled]="categoryPage === 1">Anterior</ion-button>
        <span>{{ categoryPage }} / {{ totalCategoryPages }}</span>
        <ion-button (click)="categoryPage = categoryPage + 1" [disabled]="categoryPage === totalCategoryPages">Siguiente</ion-button>
      </div>

      <div *ngIf="!isLoading && filteredCategories.length === 0" class="no-results">
        <p>No se encontraron categorías</p>
      </div>
    </div>

    <!-- ============= PERFUMES ============= -->
    <div *ngIf="selectedTab === 'perfumes'" class="tab-content">
      <h1>Gestión de Perfumes</h1>
      
      <ion-card class="filters-card">
        <ion-card-content>
          <ion-searchbar 
            placeholder="Buscar perfumes..." 
            [(ngModel)]="perfumeSearchTerm"
            (ionChange)="searchPerfumes(perfumeSearchTerm)">
          </ion-searchbar>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="table-container" *ngIf="!isLoading && filteredPerfumes.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Marca</th>
              <th>Categoría</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let perfume of paginatedPerfumes">
              <td>{{ perfume.nombre }}</td>
              <td>${{ perfume.precio | number: '1.2-2' }}</td>
              <td>{{ perfume.stock }}</td>
              <td>{{ perfume.marca || '-' }}</td>
              <td>{{ perfume.categoria || '-' }}</td>
              <td>
                <ion-button size="small" color="danger" (click)="deletePerfume(perfume.id)">
                  <ion-icon name="trash"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalPerfumePages > 1">
        <ion-button (click)="perfumePage = perfumePage - 1" [disabled]="perfumePage === 1">Anterior</ion-button>
        <span>{{ perfumePage }} / {{ totalPerfumePages }}</span>
        <ion-button (click)="perfumePage = perfumePage + 1" [disabled]="perfumePage === totalPerfumePages">Siguiente</ion-button>
      </div>

      <div *ngIf="!isLoading && filteredPerfumes.length === 0" class="no-results">
        <p>No se encontraron perfumes</p>
      </div>
    </div>

    <!-- ============= PEDIDOS ============= -->
    <div *ngIf="selectedTab === 'orders'" class="tab-content">
      <h1>Gestión de Pedidos</h1>
      
      <ion-card class="filters-card">
        <ion-card-content>
          <ion-segment [(ngModel)]="orderFilterStatus" (ionChange)="filterOrdersByStatus(orderFilterStatus)" class="filter-segment">
            <ion-segment-button value="all">Todos</ion-segment-button>
            <ion-segment-button value="pendiente">Pendientes</ion-segment-button>
            <ion-segment-button value="procesando">Procesando</ion-segment-button>
            <ion-segment-button value="enviado">Enviados</ion-segment-button>
            <ion-segment-button value="entregado">Entregados</ion-segment-button>
          </ion-segment>
        </ion-card-content>
      </ion-card>

      <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>

      <div class="table-container" *ngIf="!isLoading && filteredOrders.length > 0">
        <table class="data-table">
          <thead>
            <tr>
              <th>Número</th>
              <th>Cliente</th>
              <th>Tienda</th>
              <th>Total</th>
              <th>Estado</th>
              <th>Fecha</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of paginatedOrders">
              <td>{{ order.numero }}</td>
              <td>{{ order.cliente }}</td>
              <td>{{ order.tienda }}</td>
              <td>${{ order.total | number: '1.2-2' }}</td>
              <td>
                <ion-badge [color]="
                  order.estado === 'entregado' ? 'success' : 
                  order.estado === 'cancelado' ? 'danger' : 
                  order.estado === 'pendiente' ? 'warning' : 
                  'primary'">
                  {{ order.estado }}
                </ion-badge>
              </td>
              <td>{{ order.fecha }}</td>
              <td>
                <ion-button size="small" color="primary" (click)="viewOrderDetails(order)">
                  <ion-icon name="eye"></ion-icon>
                </ion-button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" *ngIf="totalOrderPages > 1">
        <ion-button (click)="orderPage = orderPage - 1" [disabled]="orderPage === 1">Anterior</ion-button>
        <span>{{ orderPage }} / {{ totalOrderPages }}</span>
        <ion-button (click)="orderPage = orderPage + 1" [disabled]="orderPage === totalOrderPages">Siguiente</ion-button>
      </div>

      <div *ngIf="!isLoading && filteredOrders.length === 0" class="no-results">
        <p>No se encontraron pedidos</p>
      </div>

      <!-- Modal detalles pedido -->
      <div class="detail-modal" *ngIf="selectedOrder" (click)="closeOrderDetails()">
        <div class="modal-content" (click)="$event.stopPropagation()">
          <ion-button fill="clear" class="close-btn" (click)="closeOrderDetails()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
          <h2>Detalles del Pedido</h2>
          <div class="detail-info">
            <p><strong>Número de Pedido:</strong> {{ selectedOrder.numero }}</p>
            <p><strong>Cliente:</strong> {{ selectedOrder.cliente }}</p>
            <p><strong>Tienda:</strong> {{ selectedOrder.tienda }}</p>
            <p><strong>Total:</strong> ${{ selectedOrder.total | number: '1.2-2' }}</p>
            <p><strong>Productos:</strong> {{ selectedOrder.productos }}</p>
            <p><strong>Fecha:</strong> {{ selectedOrder.fecha }}</p>
            <p><strong>Estado Actual:</strong> {{ selectedOrder.estado }}</p>
            <div class="status-actions" *ngIf="selectedOrder.estado !== 'entregado' && selectedOrder.estado !== 'cancelado'">
              <p><strong>Cambiar Estado:</strong></p>
              <ion-button size="small" (click)="updateOrderStatus(selectedOrder.id, 'procesando')">Procesando</ion-button>
              <ion-button size="small" (click)="updateOrderStatus(selectedOrder.id, 'enviado')">Enviado</ion-button>
              <ion-button size="small" (click)="updateOrderStatus(selectedOrder.id, 'entregado')">Entregado</ion-button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</ion-content>

<app-footer></app-footer>
