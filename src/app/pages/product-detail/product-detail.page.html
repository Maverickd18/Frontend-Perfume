<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Producto</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="onCartClick()">
        <ion-icon slot="icon-only" name="cart-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="goProfile()">
        <ion-icon slot="icon-only" name="person-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="product-detail">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner></ion-spinner>
    <p>Cargando producto...</p>
  </div>

  <!-- Product Content -->
  <div *ngIf="product && !isLoading" class="detail-wrapper">
    <div class="product-layout">
      <div class="image-section">
        <img 
          [src]="product.imageUrl || 'assets/images/placeholder.jpg'" 
          [alt]="product.name" 
          class="product-image"
          (error)="product.imageUrl = 'assets/images/placeholder.jpg'"/>
      </div>

      <div class="info-section">
        <div class="header-info">
          <div>
            <p class="brand">{{ product.brandName || 'Marca' }}</p>
            <h1 class="title">{{ product.name }}</h1>
          </div>
          <button 
            class="heart-button" 
            (click)="toggleFavorite()" 
            [class.active]="isFavorite" 
            title="Agregar a favoritos">
            <ion-icon 
              [name]="isFavorite ? 'heart' : 'heart-outline'" 
              [color]="isFavorite ? 'danger' : 'medium'">
            </ion-icon>
          </button>
        </div>

        <p class="description">{{ product.description }}</p>

        <div class="specs-grid">
          <div class="spec-item">
            <span class="spec-label">Tamaño</span>
            <span class="spec-value">{{ product.sizeMl }}ml</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Categoría</span>
            <span class="spec-value">{{ product.categoryName || 'Perfume' }}</span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Stock</span>
            <span class="spec-value" [class.low-stock]="product.stock <= 5">
              {{ product.stock }} unidades
            </span>
          </div>
          <div class="spec-item">
            <span class="spec-label">Género</span>
            <span class="spec-value">{{ product.genre }}</span>
          </div>
        </div>

        <div class="price-box">
          <p class="price">{{ product.price | currency:'USD':'symbol':'1.2-2' }}</p>
          <p *ngIf="product.stock <= 5 && product.stock > 0" class="stock-warning">
            ¡Últimas unidades!
          </p>
          <p *ngIf="product.stock === 0" class="out-of-stock">
            Agotado
          </p>
        </div>

        <div class="actions-buttons">
          <ion-button 
            expand="block" 
            color="primary" 
            (click)="addToCart()"
            [disabled]="product.stock === 0">
            <ion-icon slot="start" name="cart-outline"></ion-icon>
            Agregar al Carrito
          </ion-button>
          
          <ion-button 
            expand="block" 
            color="success" 
            (click)="goToCheckout()"
            [disabled]="product.stock === 0">
            <ion-icon slot="start" name="bag-check-outline"></ion-icon>
            Comprar Ahora
          </ion-button>
          
          <ion-button 
            expand="block" 
            fill="outline" 
            (click)="goBack()">
            <ion-icon slot="start" name="arrow-back-outline"></ion-icon>
            Volver
          </ion-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!product && !isLoading" class="error-container">
    <ion-icon name="warning-outline" size="large"></ion-icon>
    <h3>Producto no encontrado</h3>
    <p>El producto que buscas no está disponible.</p>
    <ion-button (click)="goHome()" fill="solid">
      <ion-icon slot="start" name="home-outline"></ion-icon>
      Volver al Inicio
    </ion-button>
  </div>
</ion-content>